<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå (SHT20)</title>
    <!-- Tailwind CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡∏Å‡∏£‡∏≤‡∏ü -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Moment.js ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/th.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-800 font-sans p-4 md:p-8">

    <div class="max-w-6xl mx-auto space-y-6">
        
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
        <header class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800 tracking-tight">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</h1>
                <p class="text-slate-500 mt-1">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏à‡∏≤‡∏Å ESP32</p>
            </div>
            <div id="status-badge" class="px-4 py-2 bg-yellow-100 text-yellow-700 rounded-full text-sm font-semibold flex items-center gap-2">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-yellow-500"></span>
                </span>
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...
            </div>
        </header>

        <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center justify-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-orange-400"></div>
                <h2 class="text-lg font-medium text-slate-500 mb-2">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                <div class="text-6xl font-black text-slate-700" id="latest-temp">-- <span class="text-3xl text-slate-400 font-medium">¬∞C</span></div>
                <p class="text-sm text-slate-400 mt-3" id="time-temp">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠: --:--</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center justify-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-blue-400"></div>
                <h2 class="text-lg font-medium text-slate-500 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                <div class="text-6xl font-black text-slate-700" id="latest-hum">-- <span class="text-3xl text-slate-400 font-medium">%</span></div>
                <p class="text-sm text-slate-400 mt-3" id="time-hum">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠: --:--</p>
            </div>
        </div>

        <!-- ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü -->
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
            
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <h2 class="text-xl font-bold text-slate-700">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ -->
                <div class="flex flex-wrap gap-2" id="time-buttons">
                    <button data-range="realtime" class="time-btn bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm hover:bg-blue-700">‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</button>
                    <button data-range="15m" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">15 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
                    <button data-range="1h" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">1 ‡∏ä‡∏°.</button>
                    <button data-range="3h" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">3 ‡∏ä‡∏°.</button>
                    <button data-range="6h" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">6 ‡∏ä‡∏°.</button>
                    <button data-range="12h" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">12 ‡∏ä‡∏°.</button>
                    <button data-range="24h" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">24 ‡∏ä‡∏°.</button>
                    <button data-range="3d" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">3 ‡∏ß‡∏±‡∏ô</button>
                    <button data-range="7d" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">7 ‡∏ß‡∏±‡∏ô</button>
                    <button data-range="1M" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                    <button data-range="3M" class="time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200">3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                </div>
            </div>

            <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü -->
            <div class="relative h-80 w-full">
                <canvas id="sensorChart"></canvas>
            </div>
            <p class="text-xs text-slate-400 mt-4 text-right">*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà 1,000 ‡∏à‡∏∏‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ Firebase ‡πÄ‡∏ï‡πá‡∏°</p>
        </div>

    </div>

    <!-- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, orderBy, limit, onSnapshot, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==========================================
        // 1. ‡∏ô‡∏≥ Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        // ==========================================
        const firebaseConfig = {
                         "type": "service_account",
                          "project_id": "dpcloud-67cdb",
                          "private_key_id": "e64bb079b21f992a724aa90b19508ab80351d4ce",
                          "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCtahsWUFkSG9bv\npWbHpsa1EsbQ/XkrKheTFFzyKd8KxIVSGwB3WxpGUreU1IM5QsFHqBE/t+3D/bEP\n3Z15KsC7BDHMpCHKTigrxZSwIqUjBrPvuxiDPgQnxlmp5OtWe20GvR1pn8zoCnZJ\nXibSk/R90uBBbgqtXifm6t1va/w6xSmepdC1MvQM6WW7ZNo2y1EvupbhbbqonRTh\n7VbNUkAmBlyRu3xR97kFqhaTWyURtDuO6g9dWj5FsuCdBsmEvyJ5dcgKJvOGutZY\nkJpRElp4vtB0Mt7eBxuf6tpsIBxmo6B21MGhJyTpz8fIbgnSUYao94aQ1Du6TsaZ\nH9OVscZDAgMBAAECggEADYOLHdeKwWhYUm+WIrE3+KIVypveJpjOooBqkoKPJkR/\nS+aHyEVaDFM43t5wEB/IISCTS4m2poMtb6+VAdLCQdtcqCES8wmD2Y65p2o5FTwv\nUdtyLb7A+HqIFT8eKddPfUAdO9R0quaEe54x3KTOtO7LLr4iaIqXBciVaK/xGtaO\npQ4NtkGSJDJ0jWFM56FZMUzTnU5gPAcgdwGXlSNQntUKLUCq6hQ+n5SLpoyacDF7\nhFNL2K8yrpSGBwyYOxYEpaViZtIYxqL6dRFCyfE6Vch9zzCp5Z0B8wXWbffqUAye\nRnc3QqzCWDq/jpCURm7bUSIEm42B9RFX9I/kP/btsQKBgQDeG4fW7mu81pCUeZFs\nqjLV+eR6Hw26nI/BzHDvSRzWrrskGZ/q29KO0JBFzhsCpdiwkV9ycW5yUqgePjog\nOxaYctEslLVyMaMbyU66/AnHrurDL3dPtrxNsfwu2OQHuqRPNGUskVsVsDPsr1a4\nHFspGkEGmkwtM/eAfvuHTUh6MQKBgQDH4GqBEReMEeaX+MZwgHG1qoLdxQ6k7Gm7\nRZH+5qs8bdhw1mbdgaY+tZB8GF8FVWWcoKa7sx4/GV6WyEyo5xlPZ3WHTmuvj8TK\nif3Vg5lwdcsEJzoJ3Scew4uITgTab525Jig3kxM+yVbkyBkSwJuCMQUGvSxxejQr\nA5FfWJ42swKBgQC96/y0JRurVi47R9i6eq8NmaltY7Bxqf6jURYhBvvJ94++xsqg\nIWhjBqTXi+48zWQFV8muKqCu0U9AzSUW+m/P3B5RaLfe9eLrl6/i5DHYthG45ZW4\nbCGIrnFd/ci/czGdKMh627BvU0STVztoI5cwBmskIjyRSqaREgQzJjqbgQKBgC8L\nKeYg4LruB6kjO4mFIb5RWKXb2JuGrUgPktI89natn/DG9cUS288MquoaTlsSA21+\n/l9VRDwzu2if0jM62WEwB6CGG6BhpT7Khbz4UWf/wX3DwcxKigeanL/DJS9IcAYA\n7hxOeIwhlVsZoZUhUjitUvKIGerHiXnKSC/5ypszAoGBAI0jga02kwjsl4csl+lG\nVzntFsEPWRfLUOxDDZK3oDXIcyCIdGzsuwRvgqxLRrbZvONx6rNDe7v3LXntPlWU\n6ghA1WPkgTcYCOg2r5YLzPVDg2j0Gscrtss9+2AWCh+MvrzdIgWKdh2UhQGj/7Gw\nSvp9uEX8mkFSrsBBVP+asKQY\n-----END PRIVATE KEY-----\n",
                          "client_email": "firebase-adminsdk-fbsvc@dpcloud-67cdb.iam.gserviceaccount.com",
                          "client_id": "107445874417767879180",
                          "auth_uri": "https://accounts.google.com/o/oauth2/auth",
                          "token_uri": "https://oauth2.googleapis.com/token",
                          "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
                          "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40dpcloud-67cdb.iam.gserviceaccount.com",
                          "universe_domain": "googleapis.com"
                     };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // ==========================================
        // 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏£‡∏≤‡∏ü Chart.js
        // ==========================================
        const ctx = document.getElementById('sensorChart').getContext('2d');
        Chart.defaults.font.family = "'Sarabun', 'Prompt', sans-serif";
        
        const sensorChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], 
                datasets: [
                    {
                        label: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)',
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        borderWidth: 2,
                        pointRadius: 2,
                        pointHoverRadius: 5,
                        data: [], 
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)',
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        pointRadius: 2,
                        pointHoverRadius: 5,
                        data: [], 
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    x: {
                        grid: { display: false }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)' },
                        grid: { drawOnChartArea: false } 
                    }
                },
                plugins: {
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                        padding: 12,
                        titleFont: { size: 14 },
                        bodyFont: { size: 13 }
                    }
                }
            }
        });

        // ==========================================
        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
        // ==========================================
        let unsubscribe = null; 

        function calculateStartTime(range) {
            const now = new Date();
            switch (range) {
                case '15m': return new Date(now.getTime() - 15 * 60000);
                case '1h': return new Date(now.getTime() - 1 * 3600000);
                case '3h': return new Date(now.getTime() - 3 * 3600000);
                case '6h': return new Date(now.getTime() - 6 * 3600000);
                case '12h': return new Date(now.getTime() - 12 * 3600000);
                case '24h': return new Date(now.getTime() - 24 * 3600000);
                case '3d': return new Date(now.getTime() - 3 * 24 * 3600000);
                case '7d': return new Date(now.getTime() - 7 * 24 * 3600000);
                case '1M': return new Date(now.setMonth(now.getMonth() - 1));
                case '3M': return new Date(now.setMonth(now.getMonth() - 3));
                default: return null;
            }
        }

        function loadData(range) {
            if (unsubscribe) {
                unsubscribe();
            }

            const statusBadge = document.getElementById('status-badge');
            statusBadge.innerHTML = `<span class="animate-spin h-4 w-4 border-2 border-slate-500 border-t-transparent rounded-full"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...`;
            statusBadge.className = 'px-4 py-2 bg-slate-100 text-slate-700 rounded-full text-sm font-semibold flex items-center gap-2';

            let q;
            if (range === 'realtime') {
                q = query(collection(db, "sensor_logs"), orderBy("timestamp", "desc"), limit(50));
            } else {
                const startTime = calculateStartTime(range);
                q = query(
                    collection(db, "sensor_logs"), 
                    where("timestamp", ">=", startTime), 
                    orderBy("timestamp", "desc"), 
                    limit(1000)
                );
            }

            unsubscribe = onSnapshot(q, (snapshot) => {
                const labels = [];
                const tempData = [];
                const humData = [];
                let isFirstDoc = true;

                snapshot.forEach((doc) => {
                    const data = doc.data();
                    
                    let timeStr = '--:--';
                    if (data.timestamp) {
                        const dateObj = data.timestamp.toDate ? data.timestamp.toDate() : new Date(data.timestamp);
                        if (['24h', '3d', '7d', '1M', '3M'].includes(range)) {
                            timeStr = moment(dateObj).format('DD/MM HH:mm');
                        } else {
                            timeStr = moment(dateObj).format('HH:mm:ss');
                        }
                    }
                    
                    labels.unshift(timeStr);
                    tempData.unshift(data.temperature);
                    humData.unshift(data.humidity);

                    if (isFirstDoc) {
                        document.getElementById('latest-temp').innerHTML = `${data.temperature.toFixed(1)} <span class="text-3xl text-slate-400 font-medium">¬∞C</span>`;
                        document.getElementById('latest-hum').innerHTML = `${data.humidity.toFixed(1)} <span class="text-3xl text-slate-400 font-medium">%</span>`;
                        
                        const updateText = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${moment().format('HH:mm:ss')}`;
                        document.getElementById('time-temp').innerText = updateText;
                        document.getElementById('time-hum').innerText = updateText;
                        isFirstDoc = false;
                    }
                });

                sensorChart.data.labels = labels;
                sensorChart.data.datasets[0].data = tempData;
                sensorChart.data.datasets[1].data = humData;
                sensorChart.update();

                statusBadge.innerHTML = `<span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span></span> ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (${snapshot.size} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
                statusBadge.className = 'px-4 py-2 bg-green-50 text-green-700 rounded-full text-sm font-semibold flex items-center gap-2 border border-green-200';

            }, (error) => {
                console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ", error);
                
                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                if (error.code === 'permission-denied') {
                    statusBadge.innerHTML = `üî¥ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Rules ‡∏Ç‡∏≠‡∏á Firestore)`;
                } else {
                    statusBadge.innerHTML = `üî¥ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`;
                }
                statusBadge.className = 'px-4 py-2 bg-red-100 text-red-700 rounded-full text-sm font-semibold flex items-center gap-2 border border-red-200';
            });
        }

        // ==========================================
        // 4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î (Active State)
        // ==========================================
        const buttons = document.querySelectorAll('.time-btn');
        buttons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                buttons.forEach(b => {
                    b.className = 'time-btn bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition hover:bg-slate-200';
                });
                
                e.target.className = 'time-btn bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm hover:bg-blue-700';
                
                const range = e.target.getAttribute('data-range');
                loadData(range);
            });
        });

        // ==========================================
        // 5. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô + ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
        // ==========================================
        signInAnonymously(auth).then(() => {
            loadData('realtime');
        }).catch((error) => {
            console.error("‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", error);
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô Anonymous ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            const statusBadge = document.getElementById('status-badge');
            if (error.code === 'auth/admin-restricted-operation') {
                statusBadge.innerHTML = `üî¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÑ‡∏õ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 'Anonymous' ‡πÉ‡∏ô Firebase Authentication`;
                statusBadge.className = 'px-4 py-2 bg-red-100 text-red-700 rounded-full text-sm font-semibold border border-red-200';
            }
            
            loadData('realtime'); 
        });

    </script>
</body>
</html>
